
name: Lint and format java code

on: [push]

env:
  CHECKSTYLE_VERSION: 10.21.3
  GOOGLE_JAVA_FORMAT_VERSION: 1.25.2

defaults:
  run:
    working-directory: backend

jobs:
  format-java:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          distribution: 'corretto'
          java-version: '17'
      - name: Download Google Java Format
        run: |
          curl -L -o google-java-format.jar https://github.com/google/google-java-format/releases/download/v${{ env.GOOGLE_JAVA_FORMAT_VERSION }}/google-java-format-${{ env.GOOGLE_JAVA_FORMAT_VERSION }}-all-deps.jar
      - name: Run Google Java Format
        run: java -jar google-java-format.jar --aosp -r $(git ls-files *.java)
      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "style: format Java files"